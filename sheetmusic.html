<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Piano Note Guessing Game</title>
    <link rel="stylesheet" href="assets/css/pianoguess.css">
</head>
<body style="background-color: #f9f2e1;">
    <a href="index.html" class="back-button" title="Go Back">back</a>

    <h1>Guess The Piano Note!</h1>
    <div id="noteDisplay">?</div>

    <div class="piano">
        <div class="white-key" data-note="C" data-freq="261.63" onclick="checkAnswer('C')"></div>
        <div class="white-key" data-note="D" data-freq="293.66" onclick="checkAnswer('D')"></div>
        <div class="white-key" data-note="E" data-freq="329.63" onclick="checkAnswer('E')"></div>
        <div class="white-key" data-note="F" data-freq="349.23" onclick="checkAnswer('F')"></div>
        <div class="white-key" data-note="G" data-freq="392.00" onclick="checkAnswer('G')"></div>
        <div class="white-key" data-note="A" data-freq="440.00" onclick="checkAnswer('A')"></div>
        <div class="white-key" data-note="B" data-freq="493.88" onclick="checkAnswer('B')"></div>

        <div class="black-key" id="cSharp" data-note="C#" data-freq="277.18" onclick="checkAnswer('C#')"></div>
        <div class="black-key" id="dSharp" data-note="D#" data-freq="311.13" onclick="checkAnswer('D#')"></div>
        <div class="black-key" id="fSharp" data-note="F#" data-freq="369.99" onclick="checkAnswer('F#')"></div>
        <div class="black-key" id="gSharp" data-note="G#" data-freq="415.30" onclick="checkAnswer('G#')"></div>
        <div class="black-key" id="aSharp" data-note="A#" data-freq="466.16" onclick="checkAnswer('A#')"></div>
    </div>

    <div id="result"></div>
    <div id="score">Score: 0</div>
    <button onclick="newNote()">New Note</button>

    <script>
        const notes = ["C","D","E","F","G","A","B","C#","D#","F#","G#","A#"];
        let currentNote = "";
        let score = 0;

        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = AudioContext ? new AudioContext() : null;

        function playPianoNote(freq) {
            if (!audioCtx || !freq) return;
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const now = audioCtx.currentTime;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.frequency.value = parseFloat(freq);
            osc.type = 'triangle';
            gain.gain.setValueAtTime(0, now);
            gain.gain.linearRampToValueAtTime(0.25, now + 0.02);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.35);
            osc.start(now);
            osc.stop(now + 0.35);
        }

        document.querySelectorAll('.white-key, .black-key').forEach(function(key) {
            key.addEventListener('click', function() {
                const freq = this.getAttribute('data-freq');
                if (freq) playPianoNote(freq);
            });
        });

        function newNote() {
            currentNote = notes[Math.floor(Math.random() * notes.length)];
            document.getElementById("noteDisplay").textContent = currentNote;
            document.getElementById("result").textContent = "";
        }

        function checkAnswer(selected) {
            if (selected === currentNote) {
                document.getElementById("result").textContent = "✅ Correct!";
                score++;
            } else {
                document.getElementById("result").textContent = "❌ Try again!";
            }
            document.getElementById("score").textContent = "Score: " + score;
        }

        newNote();
    </script>
</body>
</html>
